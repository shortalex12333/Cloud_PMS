name: Staging Show Related Acceptance

on:
  workflow_dispatch:
  push:
    paths:
      - 'tests/ci/staging_work_orders_show_related.py'
      - '.github/workflows/staging-show-related-acceptance.yml'
      - 'apps/api/handlers/related_handlers.py'
      - 'apps/api/routes/related_routes.py'

jobs:
  staging-show-related:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Run Staging Acceptance (Show Related)
        env:
          # API URL
          BASE_URL: ${{ secrets.BASE_URL }}
          STAGING_API_URL: ${{ secrets.BASE_URL }}
          RENDER_API_URL: ${{ secrets.RENDER_API_URL }}

          # Yacht ID
          STAGING_YACHT_ID: ${{ secrets.TEST_USER_YACHT_ID }}
          TEST_USER_YACHT_ID: ${{ secrets.TEST_USER_YACHT_ID }}

          # Pre-generated JWTs
          STAGING_CREW_JWT: ${{ secrets.STAGING_CREW_JWT }}
          STAGING_HOD_JWT: ${{ secrets.STAGING_HOD_JWT }}
          STAGING_CAPTAIN_JWT: ${{ secrets.STAGING_CAPTAIN_JWT }}

          # Tenant DB for dynamic entity lookup
          TENANT_SUPABASE_URL: ${{ secrets.TENANT_SUPABASE_URL }}
          TENANT_SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.TENANT_SUPABASE_SERVICE_ROLE_KEY }}

        run: |
          python tests/ci/staging_work_orders_show_related.py
