{
  "parameters": {
    "jsCode": "// =============================================================================\n// PROCESS RAG RESULTS\n// Main node that processes RAG output and generates final cards\n// \n// INPUT (from previous node):\n//   - items[0].json.ragResults: Array of RAG search results\n//   - items[0].json.entities: Extracted entities { equipment, fault_codes, part_numbers, ... }\n//   - items[0].json.intent: Detected intent string\n//   - items[0].json.userRole: User role string (optional, defaults to 'Engineer')\n//   - items[0].json.yachtConfig: Yacht config object (optional)\n//\n// OUTPUT:\n//   - cards: Array of SearchResultCard objects ready for frontend\n// =============================================================================\n\n// Get functions from static data\nconst generateCards = $workflow.staticData.generateCards;\nconst calculateFusionScores = $workflow.staticData.calculateFusionScores;\nconst deduplicateResults = $workflow.staticData.deduplicateResults;\n\n// Get input data\nconst input = $input.first().json;\n\nconst ragResults = input.ragResults || [];\nconst entities = input.entities || { equipment: [], fault_codes: [], part_numbers: [] };\nconst intent = input.intent || 'general_search';\nconst userRole = input.userRole || 'Engineer';\nconst yachtConfig = input.yachtConfig || { predictive_enabled: false };\n\n// Process results\n// 1. Deduplicate\nconst deduplicated = deduplicateResults(ragResults);\n\n// 2. Calculate fusion scores\nconst scored = calculateFusionScores(deduplicated, entities, intent);\n\n// 3. Generate cards with micro-actions\nconst cards = generateCards(scored, intent, userRole, yachtConfig);\n\n// Return cards\nreturn [{\n  json: {\n    cards: cards,\n    metadata: {\n      total_results: ragResults.length,\n      deduplicated_count: deduplicated.length,\n      final_card_count: cards.length,\n      intent: intent,\n      entities_found: {\n        equipment: entities.equipment?.length || 0,\n        fault_codes: entities.fault_codes?.length || 0,\n        part_numbers: entities.part_numbers?.length || 0\n      }\n    }\n  }\n}];"
  },
  "name": "Process RAG Results",
  "type": "n8n-nodes-base.code",
  "typeVersion": 2,
  "position": [880, 0]
}
