# ============================================
# Entity Extraction Pipeline Configuration
# v2.1.0 - Environment Variables
# ============================================

# ============================================
# Service Ports
# ============================================
EXTRACTION_API_PORT=5400
EXTRACTION_API_HOST=127.0.0.1
INTEGRATION_SERVICE_PORT=5401
INTEGRATION_SERVICE_HOST=0.0.0.0

# ============================================
# Body Size Limits
# ============================================
# Maximum request body size in KB (default: 64)
# Increase for large documents (e.g., 256, 512)
MAX_BODY_KB=64

# Allowed CORS origins (comma-separated). If unset, '*' allowed only in non-production
# Example: https://app.example.com,https://admin.example.com
ALLOWED_CORS_ORIGINS=

# ============================================
# Confidence Thresholds
# ============================================
# JSON object with thresholds by entity type
# Default shown below - adjust to tune precision/recall
# Higher threshold = higher precision, lower recall
CONFIDENCE_THRESHOLDS_JSON={"equipment":0.70,"measurement":0.75,"fault_code":0.70,"model":0.75,"org":0.75,"org_ai":0.85,"status":0.75,"symptom":0.80,"system":0.75,"location_on_board":0.75,"action":0.70}

# ============================================
# Source Multipliers
# ============================================
# Reliability weights for extraction sources
# Higher multiplier = more trusted source
SOURCE_MULTIPLIERS_JSON={"regex":1.0,"gazetteer":0.95,"proper_noun":0.85,"spacy":0.80,"ai":0.70,"fallback_py":0.90}

# ============================================
# Overlap Resolution
# ============================================
# Scoring weights for resolving overlapping entities
# Score = w1*adjusted_conf + w2*span_length + w3*type_priority
# Sum should equal 1.0 for interpretability
OVERLAP_WEIGHTS_JSON={"adjusted_confidence":0.5,"span_length_norm":0.3,"type_priority":0.2}

# Type precedence (higher = more important)
# Used as tiebreaker in overlap resolution
TYPE_PRECEDENCE_JSON={"fault_code":100,"model":90,"part_number":85,"equipment":80,"org":70,"measurement":60,"location_on_board":50,"action":40,"status":30,"other":10}

# ============================================
# Brand Expansions (Bi-directional)
# ============================================
# Maps brand full names to common abbreviations
# Used for evidence-based ORG validation
BRAND_EXPANSIONS_JSON={"caterpillar":["cat","cat marine","caterpillar marine"],"cummins":["qsm","cummins marine"],"northern lights":["northern","nl"],"volvo penta":["volvo","vp"],"mtu":["mtu friedrichshafen"],"man":["man diesel","man engines"],"yanmar":["yanmar marine"],"kohler":["kohler power"],"onan":["onan generator","cummins onan"]}

# ============================================
# Model â†’ Brand Evidence
# ============================================
# Maps model numbers to their manufacturers
# Used to validate ORGs via model presence
MODEL_BRAND_MAPPING_JSON={"c32":"caterpillar","c18":"caterpillar","c12":"caterpillar","c9":"caterpillar","c7":"caterpillar","3516":"caterpillar","3512":"caterpillar","qsm11":"cummins","qsb":"cummins","qsc":"cummins","m643":"northern lights","m773":"northern lights","d4":"volvo penta","d6":"volvo penta","d9":"volvo penta","d12":"volvo penta","16v2000":"mtu","12v2000":"mtu","d2862":"man","d2868":"man"}

# ============================================
# Location Synonyms
# ============================================
# Canonical location terms with common variants
LOCATION_SYNONYMS_JSON={"engine room":["er","machinery space","engine space"],"bridge":["wheelhouse","pilothouse"],"galley":["kitchen"],"lazarette":["laz","storage"],"bow":["forward","fwd"],"stern":["aft"],"port":["left"],"starboard":["right","stbd"]}

# ============================================
# Gating Policy
# ============================================
# Minimum entities required after merge (0 = no hard gate)
MIN_MERGED_ENTITIES=0

# Allow per-request override of empty gate
ALLOW_EMPTY_OVERRIDE=true

# ============================================
# Fallback Configuration
# ============================================
# Python fallback extractor timeout (ms)
FALLBACK_TIMEOUT_MS=10000

# Maximum stderr length to capture from fallback
FALLBACK_MAX_STDERR=1000

# Python interpreter for fallback extractor (absolute path recommended in production)
# Example: /usr/bin/python3 or /venv/bin/python3
PYTHON_INTERPRETER_PATH=python3

# Enable standalone extraction mode (Python CLI fallback)
STANDALONE_EXTRACTION_MODE=true

# Fallback to regex-only on AI failure
FALLBACK_TO_REGEX_ONLY_ON_AI_FAILURE=true

# ============================================
# AI Configuration
# ============================================
AI_ENABLED=true
OLLAMA_HOST=http://localhost:11434
OLLAMA_MODEL=qwen2.5:3b-instruct-q5_K_M
AI_TIMEOUT=30000

# ============================================
# Debugging & Observability
# ============================================
# Enable debug logging (verbose output)
DEBUG_EXTRACTION=false

# Enable reason code tracking
ENABLE_REASON_CODES=true

# Enable stage latency tracking
ENABLE_STAGE_LATENCIES=true

# Size of metrics histogram for P95 calculation
METRICS_HISTOGRAM_SIZE=100

# Node environment
NODE_ENV=production

# Log level
LOG_LEVEL=info

# ============================================
# Feature Flags
# ============================================
ENABLE_CACHE=true
ENABLE_METRICS=true
ENABLE_HEALTH_CHECKS=true
ENABLE_CORS=true

# ============================================
# Budget Configuration (Weight System)
# ============================================
BUDGET_TOTAL=4000
BUDGET_MIN=250
BUDGET_MAX=1500

# ============================================
# Merge Configuration
# ============================================
MERGE_STRATEGY=average
BUDGET_STRATEGY=average
MERGE_THRESHOLD=0.85

# ============================================
# Retry Configuration
# ============================================
DEFAULT_RETRY_ATTEMPTS=3
RETRY_DELAY_MS=1000

# ============================================
# USAGE NOTES
# ============================================
#
# 1. JSON values MUST be valid JSON (use double quotes, no trailing commas)
# 2. Restart services after changing values
# 3. Check /health endpoint to verify active config
# 4. Start with defaults, tune incrementally
#
# TUNING GUIDELINES:
#
# - Increase MAX_BODY_KB if processing large documents
# - Lower org_ai threshold (e.g., 0.80) to increase ORG recall
# - Raise equipment threshold (e.g., 0.75) to reduce equipment FPs
# - Adjust overlap weights to prefer span length over confidence:
#   {"adjusted_confidence":0.4,"span_length_norm":0.4,"type_priority":0.2}
# - Enable DEBUG_EXTRACTION=true to see detailed decisions
#
# ============================================
