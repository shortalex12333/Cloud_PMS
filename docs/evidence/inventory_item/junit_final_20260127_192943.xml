<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="0" failures="1" skipped="2" tests="18" time="12.404" timestamp="2026-01-27T19:29:43.624007" hostname="celesteos.local"><testcase classname="tests.test_inventory_critical.TestConcurrency" name="test_concurrent_consume_atomic" time="2.703" /><testcase classname="tests.test_inventory_critical.TestConcurrency" name="test_concurrent_receive_atomic" time="0.920" /><testcase classname="tests.test_inventory_critical.TestIdempotency" name="test_duplicate_receive_blocked" time="0.891" /><testcase classname="tests.test_inventory_critical.TestSoftDelete" name="test_consume_blocked_on_deactivated" time="0.277" /><testcase classname="tests.test_inventory_critical.TestSoftDelete" name="test_trigger_blocks_transaction_insert" time="0.884" /><testcase classname="tests.test_inventory_critical.TestSoftDelete" name="test_reactivate_restores_mutations" time="1.443" /><testcase classname="tests.test_inventory_critical.TestReversalUniqueness" name="test_double_reversal_blocked" time="0.338" /><testcase classname="tests.test_inventory_critical.TestReversalUniqueness" name="test_reversal_of_reversal_blocked" time="0.872" /><testcase classname="tests.test_inventory_critical.TestTransactionTypeRLS" name="test_transaction_type_rls_policies_exist" time="0.191" /><testcase classname="tests.test_inventory_critical.TestTransactionTypeRLS" name="test_crew_cannot_insert_write_off_via_api" time="0.000"><skipped type="pytest.skip" message="RLS enforcement requires PostgREST API, not direct SQL">/Volumes/Backup/CELESTE/BACK_BUTTON_CLOUD_PMS/tests/inventory_lens/tests/test_inventory_critical.py:455: RLS enforcement requires PostgREST API, not direct SQL</skipped></testcase><testcase classname="tests.test_inventory_critical.TestTransactionTypeRLS" name="test_crew_cannot_insert_reversed_via_api" time="0.000"><skipped type="pytest.skip" message="RLS enforcement requires PostgREST API, not direct SQL">/Volumes/Backup/CELESTE/BACK_BUTTON_CLOUD_PMS/tests/inventory_lens/tests/test_inventory_critical.py:463: RLS enforcement requires PostgREST API, not direct SQL</skipped></testcase><testcase classname="tests.test_inventory_critical.TestTransferValidation" name="test_transfer_same_location_blocked" time="0.850" /><testcase classname="tests.test_inventory_critical.TestHelperParity" name="test_is_operational_crew_with_existing_users" time="0.166" /><testcase classname="tests.test_inventory_critical.TestHelperParity" name="test_is_hod_helper_function" time="0.792" /><testcase classname="tests.test_inventory_critical.TestDualLedgerConsistency" name="test_no_inventory_drift" time="0.336" /><testcase classname="tests.test_inventory_critical.TestStorageNegativeControls" name="test_documents_wrong_prefix_denied" time="0.738" /><testcase classname="tests.test_inventory_critical.TestStorageNegativeControls" name="test_labels_wrong_prefix_denied" time="0.127" /><testcase classname="tests.test_inventory_critical.TestStorageNegativeControls" name="test_storage_policies_require_operational_crew" time="0.782"><failure message="AssertionError: Policy yacht_labels_insert should check is_operational_crew()&#10;assert 'is_operational_crew' in '{boolexpr :boolop and :args ({opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({var :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {const :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({subscriptingref :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({const :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr &lt;&gt; :refexpr {funcexpr :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({var :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr &lt;&gt;} {coerceviaio :arg {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {funcexpr :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({funcexpr :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1}) :location -1}) :location -1}'&#10; +  where '{boolexpr :boolop and :args ({opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({var :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {const :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({subscriptingref :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({const :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr &lt;&gt; :refexpr {funcexpr :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({var :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr &lt;&gt;} {coerceviaio :arg {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {funcexpr :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({funcexpr :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1}) :location -1}) :location -1}' = &lt;built-in method lower of str object at 0xc406cd000&gt;()&#10; +    where &lt;built-in method lower of str object at 0xc406cd000&gt; = '{BOOLEXPR :boolop and :args ({OPEXPR :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {CONST :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {OPEXPR :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({SUBSCRIPTINGREF :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({CONST :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr &lt;&gt; :refexpr {FUNCEXPR :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({VAR :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr &lt;&gt;} {COERCEVIAIO :arg {FUNCEXPR :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {FUNCEXPR :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({FUNCEXPR :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} {FUNCEXPR :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1}) :location -1}) :location -1}'.lower">tests/test_inventory_critical.py:657: in test_storage_policies_require_operational_crew
    assert 'is_operational_crew' in policy['check_clause'].lower(), \
E   AssertionError: Policy yacht_labels_insert should check is_operational_crew()
E   assert 'is_operational_crew' in '{boolexpr :boolop and :args ({opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({var :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {const :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({subscriptingref :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({const :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr &lt;&gt; :refexpr {funcexpr :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({var :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr &lt;&gt;} {coerceviaio :arg {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {funcexpr :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({funcexpr :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1}) :location -1}) :location -1}'
E    +  where '{boolexpr :boolop and :args ({opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({var :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {const :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({subscriptingref :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({const :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr &lt;&gt; :refexpr {funcexpr :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({var :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr &lt;&gt;} {coerceviaio :arg {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {funcexpr :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({funcexpr :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1}) :location -1}) :location -1}' = &lt;built-in method lower of str object at 0xc406cd000&gt;()
E    +    where &lt;built-in method lower of str object at 0xc406cd000&gt; = '{BOOLEXPR :boolop and :args ({OPEXPR :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {CONST :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {OPEXPR :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({SUBSCRIPTINGREF :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({CONST :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr &lt;&gt; :refexpr {FUNCEXPR :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({VAR :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr &lt;&gt;} {COERCEVIAIO :arg {FUNCEXPR :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {FUNCEXPR :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({FUNCEXPR :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1} {FUNCEXPR :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location -1}) :location -1}) :location -1}'.lower</failure></testcase></testsuite></testsuites>