============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-7.4.3, pluggy-1.6.0 -- /Library/Developer/CommandLineTools/usr/bin/python3
cachedir: .pytest_cache
rootdir: /Volumes/Backup/CELESTE/BACK_BUTTON_CLOUD_PMS/tests/inventory_lens
configfile: pytest.ini
plugins: mock-3.15.1, Faker-20.1.0, cov-4.1.0, asyncio-0.21.1, anyio-3.7.1, langsmith-0.4.8
asyncio: mode=auto
collecting ... collected 24 items / 6 deselected / 18 selected

tests/test_inventory_critical.py::TestConcurrency::test_concurrent_consume_atomic PASSED [  5%]
tests/test_inventory_critical.py::TestConcurrency::test_concurrent_receive_atomic PASSED [ 11%]
tests/test_inventory_critical.py::TestIdempotency::test_duplicate_receive_blocked PASSED [ 16%]
tests/test_inventory_critical.py::TestSoftDelete::test_consume_blocked_on_deactivated PASSED [ 22%]
tests/test_inventory_critical.py::TestSoftDelete::test_trigger_blocks_transaction_insert PASSED [ 27%]
tests/test_inventory_critical.py::TestSoftDelete::test_reactivate_restores_mutations PASSED [ 33%]
tests/test_inventory_critical.py::TestReversalUniqueness::test_double_reversal_blocked PASSED [ 38%]
tests/test_inventory_critical.py::TestReversalUniqueness::test_reversal_of_reversal_blocked PASSED [ 44%]
tests/test_inventory_critical.py::TestTransactionTypeRLS::test_transaction_type_rls_policies_exist PASSED [ 50%]
tests/test_inventory_critical.py::TestTransactionTypeRLS::test_crew_cannot_insert_write_off_via_api SKIPPED [ 55%]
tests/test_inventory_critical.py::TestTransactionTypeRLS::test_crew_cannot_insert_reversed_via_api SKIPPED [ 61%]
tests/test_inventory_critical.py::TestTransferValidation::test_transfer_same_location_blocked PASSED [ 66%]
tests/test_inventory_critical.py::TestHelperParity::test_is_operational_crew_with_existing_users PASSED [ 72%]
tests/test_inventory_critical.py::TestHelperParity::test_is_hod_helper_function PASSED [ 77%]
tests/test_inventory_critical.py::TestDualLedgerConsistency::test_no_inventory_drift PASSED [ 83%]
tests/test_inventory_critical.py::TestStorageNegativeControls::test_documents_wrong_prefix_denied PASSED [ 88%]
tests/test_inventory_critical.py::TestStorageNegativeControls::test_labels_wrong_prefix_denied PASSED [ 94%]
tests/test_inventory_critical.py::TestStorageNegativeControls::test_storage_policies_require_operational_crew FAILED [100%]

=================================== FAILURES ===================================
__ TestStorageNegativeControls.test_storage_policies_require_operational_crew __
tests/test_inventory_critical.py:657: in test_storage_policies_require_operational_crew
    assert 'is_operational_crew' in policy['check_clause'].lower(), \
E   AssertionError: Policy yacht_labels_insert should check is_operational_crew()
E   assert 'is_operational_crew' in '{boolexpr :boolop and :args ({opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({var :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {const :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({subscriptingref :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({const :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr <> :refexpr {funcexpr :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({var :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr <>} {coerceviaio :arg {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {funcexpr :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({funcexpr :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1} {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1}) :location -1}) :location -1}'
E    +  where '{boolexpr :boolop and :args ({opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({var :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {const :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {opexpr :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({subscriptingref :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({const :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr <> :refexpr {funcexpr :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({var :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr <>} {coerceviaio :arg {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {funcexpr :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({funcexpr :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1} {funcexpr :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1}) :location -1}) :location -1}' = <built-in method lower of str object at 0xc406cd000>()
E    +    where <built-in method lower of str object at 0xc406cd000> = '{BOOLEXPR :boolop and :args ({OPEXPR :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1} {CONST :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location -1 :constvalue 18 [ 72 0 0 0 112 109 115 45 108 97 98 101 108 45 112 100 102 115 ]}) :location -1} {OPEXPR :opno 98 :opfuncid 67 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 100 :args ({SUBSCRIPTINGREF :refcontainertype 1009 :refelemtype 25 :refrestype 25 :reftypmod -1 :refcollid 100 :refupperindexpr ({CONST :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location -1 :constvalue 4 [ 1 0 0 0 0 0 0 0 ]}) :reflowerindexpr <> :refexpr {FUNCEXPR :funcid 17297 :funcresulttype 1009 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({VAR :varno 1 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 3 :location -1}) :location -1} :refassgnexpr <>} {COERCEVIAIO :arg {FUNCEXPR :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1} :resulttype 25 :resultcollid 100 :coerceformat 1 :location -1}) :location -1} {FUNCEXPR :funcid 154953 :funcresulttype 16 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args ({FUNCEXPR :funcid 16538 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1} {FUNCEXPR :funcid 18701 :funcresulttype 2950 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args <> :location -1}) :location -1}) :location -1}'.lower
- generated xml file: /Volumes/Backup/CELESTE/BACK_BUTTON_CLOUD_PMS/docs/evidence/inventory_item/junit_final_20260127_192943.xml -
=========================== short test summary info ============================
FAILED tests/test_inventory_critical.py::TestStorageNegativeControls::test_storage_policies_require_operational_crew
====== 1 failed, 15 passed, 2 skipped, 6 deselected, 3 warnings in 12.40s ======
