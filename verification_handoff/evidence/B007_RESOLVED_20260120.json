{
  "blocker": "B007",
  "name": "Documents Table Anonymous RLS Bypass",
  "severity": "SECURITY-CRITICAL",
  "status": "RESOLVED",
  "resolved_at": "2026-01-20T13:35:00Z",
  "database": "vzsohavtuotocgrfkfyd (TENANT)",

  "root_cause": {
    "issue": "documents is a VIEW on doc_metadata table",
    "problem": "Views run as definer (postgres) by default, bypassing RLS",
    "rls_existed": "doc_metadata had RLS policies but view bypassed them"
  },

  "fix_applied": {
    "sql": "ALTER VIEW public.documents SET (security_invoker = true)",
    "explanation": "Makes view respect RLS policies of underlying table by running as invoker"
  },

  "verification": {
    "anonymous_test": {
      "endpoint": "GET /rest/v1/documents?select=*&limit=1",
      "auth": "anon key only",
      "result": "[] (empty array)",
      "verdict": "BLOCKED - anonymous access denied"
    },
    "authenticated_test": {
      "endpoint": "GET /rest/v1/documents?select=*&limit=3",
      "auth": "User JWT for yacht 85fe1119-b04c-41ac-80f1-829d23322598",
      "result": "Returns documents for user's yacht",
      "verdict": "PASSED - authenticated access works"
    }
  },

  "conclusion": "B007 RESOLVED - Documents view now respects RLS via security_invoker setting"
}
