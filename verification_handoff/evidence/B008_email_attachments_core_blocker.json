{
  "blocker_id": "B008",
  "name": "Missing email_attachments Table",
  "severity": "CORE_FUNCTIONALITY_BLOCKER",
  "date_discovered": "2026-01-19",
  "date_confirmed": "2026-01-20T12:50:00Z",
  "status": "CONFIRMED ACTIVE",
  
  "issue": {
    "description": "email_attachments table does not exist in database",
    "expected_table": "public.email_attachments",
    "actual_response": "PGRST205 - Could not find the table",
    "hint_from_postgrest": "Perhaps you meant 'public.pms_attachments'",
    "note": "pms_attachments is for PMS work orders, NOT email attachments"
  },
  
  "impact": {
    "affected_feature": "Email attachment viewing and download",
    "user_impact": "Users cannot view or download email attachments",
    "workaround": "None - attachments from ingested emails are lost/inaccessible"
  },
  
  "related_tables_that_exist": {
    "email_watchers": true,
    "email_threads": true,
    "email_messages": true,
    "email_attachments": false
  },
  
  "evidence": {
    "api_call": "GET /rest/v1/email_attachments?select=*&limit=1",
    "response_code": "PGRST205",
    "response_message": "Could not find the table 'public.email_attachments' in the schema cache"
  },
  
  "reclassification_reason": "Per VERIFICATION CORRECTION DIRECTIVE: email_attachments missing is not a minor gap - it prevents core email functionality. Users cannot access attachments from ingested emails.",
  
  "recommended_fix": {
    "action": "Create email_attachments table",
    "schema": {
      "id": "uuid PRIMARY KEY DEFAULT gen_random_uuid()",
      "message_id": "uuid REFERENCES email_messages(id)",
      "yacht_id": "uuid NOT NULL",
      "filename": "text NOT NULL",
      "content_type": "text",
      "size_bytes": "integer",
      "storage_path": "text",
      "graph_attachment_id": "text",
      "created_at": "timestamptz DEFAULT now()"
    },
    "rls_policy": "Same as email_messages - yacht_id scoping"
  },
  
  "priority": "HIGH - Blocks email attachment functionality",
  "blocks": ["Email UX (Phase 06)", "Email search with attachments"],
  
  "conclusion": "B008 CONFIRMED as CORE_FUNCTIONALITY_BLOCKER. Table creation required before email attachment features can work."
}
