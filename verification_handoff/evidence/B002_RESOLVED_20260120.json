{
  "blocker": "B002",
  "name": "Missing PMS Tables",
  "status": "RESOLVED",
  "resolved_at": "2026-01-20T14:00:00Z",
  "database": "vzsohavtuotocgrfkfyd (TENANT)",

  "tables_created": [
    {
      "name": "pms_maintenance_schedules",
      "purpose": "Preventive maintenance schedules for equipment",
      "columns": ["id", "yacht_id", "equipment_id", "task_name", "description", "frequency", "frequency_days", "frequency_hours", "last_completed_at", "next_due_at", "assigned_to", "priority", "status", "deferral_reason", "metadata", "created_at", "updated_at", "created_by"],
      "actions_unblocked": ["create_pm_schedule", "complete_pm_task", "defer_pm_task", "update_pm_schedule", "deactivate_equipment_schedules"]
    },
    {
      "name": "pms_certificates",
      "purpose": "Yacht and equipment certificates with expiry tracking",
      "columns": ["id", "yacht_id", "certificate_name", "certificate_type", "certificate_number", "issuing_authority", "issue_date", "expiry_date", "document_id", "equipment_id", "status", "superseded_by", "notes", "metadata", "created_at", "updated_at", "created_by"],
      "actions_unblocked": ["add_certificate", "renew_certificate", "update_certificate"]
    },
    {
      "name": "pms_service_contracts",
      "purpose": "Service contracts, warranties, and maintenance agreements",
      "columns": ["id", "yacht_id", "contract_name", "vendor_name", "vendor_id", "contract_type", "contract_number", "start_date", "end_date", "value", "currency", "coverage_details", "equipment_ids", "document_id", "status", "auto_renew", "renewal_notice_days", "claims_count", "notes", "metadata", "created_at", "updated_at", "created_by"],
      "actions_unblocked": ["link_service_contract", "record_warranty_claim"]
    }
  ],

  "rls_policies": {
    "pattern": "Uses get_user_yacht_id() function for yacht isolation",
    "select": "All authenticated users can view their yacht's data",
    "insert": "Officers (chief_engineer, eto, manager, captain, purser) can create",
    "update": "Officers can update",
    "delete": "Managers only",
    "service_role": "Full access"
  },

  "foreign_keys": {
    "yacht_id": "yacht_registry(id) ON DELETE CASCADE",
    "equipment_id": "pms_equipment(id) ON DELETE SET NULL",
    "document_id": "doc_metadata(id) ON DELETE SET NULL",
    "vendor_id": "pms_suppliers(id) ON DELETE SET NULL",
    "user_ids": "auth.users(id)"
  },

  "tables_not_created": {
    "pms_schedule_templates": "Not referenced in code - documented only",
    "pms_compliance_items": "Not referenced in code - documented only"
  },

  "verification": {
    "api_tests": {
      "pms_maintenance_schedules": "200 OK - []",
      "pms_certificates": "200 OK - []",
      "pms_service_contracts": "200 OK - []"
    },
    "verdict": "PASSED - All tables accessible via API"
  },

  "conclusion": "B002 RESOLVED - Created 3 missing PMS tables with proper schema, RLS, and indexes. ~10 microactions unblocked."
}
