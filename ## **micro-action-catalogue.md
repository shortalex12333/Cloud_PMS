## **micro-action-catalogue.md**

**CelesteOS — Micro Action Catalogue (V1)**
*Authoritative definitions of user actions generated by the Search Engine.*

---

# ## 1. Purpose

Micro-actions are **dynamic, context-driven operations** that appear on search result cards in the CelesteOS frontend.
Actions are assigned by the **Search Engine** based on:

* extracted entities
* detected intent
* card type
* role permissions
* yacht configuration

Frontend only **renders** these actions and **POSTs** payloads to the provided endpoint.

Frontend **never guesses**, **never hardcodes**, and **never constructs routes**.

Backend defines ALL actions.

---

# ## 2. Action Data Structure (Canonical)

Every action is returned as:

```json
{
  "label": "Add Note",
  "action": "add_note",
  "endpoint": "/v1/notes/create",
  "method": "POST",
  "payload_template": {
    "yacht_id": "<yid>",
    "equipment_id": "<uuid>",
    "note_text": ""
  },
  "constraints": {
    "requires_equipment_id": true,
    "requires_note_text": true,
    "role": ["HOD", "Engineer"]
  }
}
```

* **label** → What the UI shows
* **action** → Internal identifier
* **endpoint** → Backend route
* **payload_template** → Fill this with user input
* **constraints** → Rules enforced by backend & search engine

---

# ## 3. Global Rules for Actions

1. Actions depend entirely on **card type** + **intent**.
2. Actions always link to a **single backend endpoint**.
3. Frontend **never decides** which actions to show.
4. Backend validates:

   * role
   * yacht_id
   * entity presence
   * payload completeness
5. Actions never mutate data directly — all mutating actions route to:

   * an API endpoint
   * an n8n workflow
   * Supabase inserts

---

# ## 4. Catalogue of All Micro-Actions (V1)

Organised by **card type**.

---

# ### 4.1 Equipment Card Actions

Shown when card_type = `equipment`.

#### **1. Add Note**

```
action: add_note
endpoint: /v1/notes/create
payload: {
  yacht_id,
  equipment_id,
  note_text
}
```

#### **2. Create Work Order**

```
action: create_work_order
endpoint: /v1/work-orders/create
payload: {
  yacht_id,
  equipment_id,
  title,
  description,
  priority
}
```

#### **3. View History**

```
action: view_history
endpoint: /v1/work-orders/history?equipment_id=<uuid>
method: GET
```

#### **4. Add to Handover**

```
action: add_to_handover
endpoint: /v1/handover/add-item
payload: {
  yacht_id,
  equipment_id,
  summary_text
}
```

#### **5. Open Documents**

```
action: show_related_documents
endpoint: /v1/search?q=<equipment manual>
method: GET
```

---

# ### 4.2 Document Card Actions

Shown when card_type = `document` or `document_chunk`.

#### **1. Open Document**

```
action: open_document
endpoint: /v1/documents/open
payload: { storage_path }
```

#### **2. Add to Handover**

```
action: add_document_to_handover
endpoint: /v1/handover/add-document
payload: {
  yacht_id,
  document_id,
  context
}
```

#### **3. View Full Manual (if chunked)**

```
action: view_full_document
endpoint: /v1/documents/full?document_id=<uuid>
method: GET
```

---

# ### 4.3 Fault Card Actions

Shown when card_type = `fault`.

#### **1. Diagnose Fault**

```
action: diagnose_fault
endpoint: /v1/search?q=fault <code>
method: GET
```

#### **2. Create Work Order for Fault**

```
action: create_work_order_fault
endpoint: /v1/work-orders/create
payload: {
  yacht_id,
  suspected_fault_code,
  equipment_id,
  description
}
```

#### **3. Add Note**

```
action: add_note
endpoint: /v1/notes/create
payload: {
  yacht_id,
  equipment_id,
  note_text
}
```

#### **4. View Related Documents**

```
action: related_documents
endpoint: /v1/search?q=<fault code> documentation
```

---

# ### 4.4 Work Order Card Actions

Shown when card_type = `work_order`.

#### **1. Add Note to Work Order**

```
action: add_note_to_work_order
endpoint: /v1/work-orders/add-note
payload: {
  yacht_id,
  work_order_id,
  note_text
}
```

#### **2. Mark as Complete**

```
action: close_work_order
endpoint: /v1/work-orders/close
payload: {
  yacht_id,
  work_order_id
}
```

#### **3. View Work Order History**

```
action: view_work_order_history
endpoint: /v1/work-orders/history?work_order_id=<id>
method: GET
```

---

# ### 4.5 Part / Inventory Card Actions

Shown when card_type = `part`.

#### **1. Check Stock**

```
action: view_stock
endpoint: /v1/inventory/stock?part_id=<id>
method: GET
```

#### **2. Order Part**

```
action: order_part
endpoint: /v1/inventory/order-part
payload: {
  yacht_id,
  part_id,
  qty
}
```

#### **3. Add to Handover**

```
action: add_part_to_handover
endpoint: /v1/handover/add-part
payload: {
  yacht_id,
  part_id,
  reason
}
```

---

# ### 4.6 Predictive Card Actions

Shown when card_type = `predictive`.

#### **1. Add Predictive Insight to Handover**

```
action: add_predictive_to_handover
endpoint: /v1/handover/add-predictive
payload: {
  yacht_id,
  equipment_id,
  insight_id,
  summary
}
```

#### **2. View Equipment**

```
action: view_equipment
endpoint: /v1/search?q=<equipment name>
method: GET
```

---

# ### 4.7 Handover Card Actions

Shown when card_type = `handover`.

#### **1. Edit Handover Section**

```
action: edit_handover_section
endpoint: /v1/handover/edit-section
payload: {
  yacht_id,
  handover_id,
  section_name,
  new_text
}
```

#### **2. Export Handover**

```
action: export_handover
endpoint: /v1/handover/export
payload: { yacht_id }
```

---

# ## 5. Action → Intent Mapping

| Intent             | Typical Action          |
| ------------------ | ----------------------- |
| add_note           | Add Note                |
| create_work_order  | Create Work Order       |
| find_document      | Open Document           |
| diagnose_fault     | Diagnose Fault          |
| find_part          | View Stock / Order Part |
| add_to_handover    | Add to Handover         |
| equipment_history  | View History            |
| predictive_request | Add Predictive Insight  |

---

# ## 6. Role Permissions

Example:

* **Engineer**: can create WOs, add notes, add to handover
* **HOD/Chief Engineer**: can close WOs, export handover, configure thresholds
* **ETO/Deck/Stew**: read-only except for notes
* **Guest/Viewer**: read-only

Actions will include:

```
"constraints": { "role": ["Engineer", "HOD"] }
```

Backend enforces this; frontend only hides unauthorized actions.

---

# ## 7. Lifecycle of an Action (Full Example)

User query:

> “fault E122 on main engine — what do I do?”

Search engine outputs FaultCard with actions:

```
- Diagnose Fault
- Create Work Order
- Add Note
- View Related Documents
```

User clicks **Create Work Order** → frontend opens modal → POST → `/v1/work-orders/create` → n8n workflow → Supabase → search engine updated.

---

# ## 8. Why Micro-Actions Matter

* New actions can be added **without touching frontend**.
* Entire system becomes driven by search + backend logic.
* Crew sees only what is relevant.
* UX stays minimal and consistent.
* Handover creation becomes automatic.

---

# ## 9. Future Actions (V2+)

* “Schedule recurring task”
* “Search global fleet data”
* “Predict spare consumption”
* “Compare OEM patterns”
* “Auto-diagnose fault chain”

---

# ## 10. Summary

This catalogue defines:

* All available actions
* Their backend endpoints
* Payload structures
* Permissions
* How search engine assigns them
* How frontend renders and executes them

This is the **source of truth for CelesteOS action routing.**

---