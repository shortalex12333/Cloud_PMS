---
phase: 13-gap-remediation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/cards/WorkOrderCard.tsx
  - apps/web/src/components/email/RelatedEmailsPanel.tsx
autonomous: true
requirements:
  - WO-03
  - CLEAN-01

must_haves:
  truths:
    - "WorkOrderCard displays reassign and archive action buttons"
    - "RelatedEmailsPanel does NOT show 'email integration is off' message"
    - "Users can click reassign button to trigger reassignment flow"
    - "Users can click archive button to archive work order"
  artifacts:
    - path: "apps/web/src/components/cards/WorkOrderCard.tsx"
      provides: "Reassign and archive action buttons"
      contains: "reassign|archive"
    - path: "apps/web/src/components/email/RelatedEmailsPanel.tsx"
      provides: "Clean email panel without disabled message"
      min_lines: 50
  key_links:
    - from: "WorkOrderCard.tsx"
      to: "ActionButton component"
      via: "action prop with reassign_work_order and archive_work_order"
      pattern: "reassign_work_order|archive_work_order"
---

<objective>
Add missing WorkOrder action buttons (reassign/archive) and remove the "email integration is off" message from RelatedEmailsPanel.

Purpose: Complete WO-03 and CLEAN-01 verification gaps - two quick UI fixes in existing components.
Output: Updated WorkOrderCard.tsx with reassign/archive actions, updated RelatedEmailsPanel.tsx without disabled message.
</objective>

<execution_context>
@/Users/celeste7/.claude/get-shit-done/workflows/execute-plan.md
@/Users/celeste7/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/components/cards/WorkOrderCard.tsx
@apps/web/src/components/email/RelatedEmailsPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add reassign and archive actions to WorkOrderCard</name>
  <files>apps/web/src/components/cards/WorkOrderCard.tsx</files>
  <action>
Add two new action buttons to WorkOrderCard.tsx for reassign and archive functionality:

1. In the Primary Actions section (around line 330), add ActionButton components for:
   - `reassign_work_order` - allows reassigning work order to another crew member
   - `archive_work_order` - allows archiving completed/cancelled work orders

2. These should be included in the actions array passed to the component OR added directly as ActionButtons in the header section alongside existing actions.

3. Follow the existing pattern used for other actions (see lines 332-346 for ActionButton usage).

4. Import Archive icon from lucide-react if not already imported.

5. The archive action should only be visible for work orders with status 'completed' or 'cancelled'. Add conditional rendering:
   ```tsx
   {(workOrder.status === 'completed' || workOrder.status === 'cancelled') && (
     <ActionButton
       action="archive_work_order"
       context={actionContext}
       variant="ghost"
       size="sm"
       showIcon={true}
     />
   )}
   ```

6. The reassign action should be available for all non-archived work orders.
  </action>
  <verify>
Run TypeScript check: `cd /Volumes/Backup/CELESTE/BACK_BUTTON_CLOUD_PMS/apps/web && npx tsc --noEmit`
Grep for new actions: `grep -n "reassign_work_order\|archive_work_order" apps/web/src/components/cards/WorkOrderCard.tsx`
  </verify>
  <done>WorkOrderCard.tsx contains ActionButton for reassign_work_order and archive_work_order with proper conditional rendering.</done>
</task>

<task type="auto">
  <name>Task 2: Remove "email integration is off" message from RelatedEmailsPanel</name>
  <files>apps/web/src/components/email/RelatedEmailsPanel.tsx</files>
  <action>
Remove the "email integration is off" UI block from RelatedEmailsPanel.tsx:

1. Locate the feature disabled state block (lines 43-61) that displays:
   - "Email integration is off" message
   - "Connect Outlook in Settings" button

2. Remove or comment out the entire conditional block that checks `if (!featureEnabled)` and returns the disabled state UI.

3. Instead, when email feature is disabled, return null (render nothing) so the panel doesn't appear at all:
   ```tsx
   // Feature disabled state - don't render panel at all
   if (!featureEnabled) {
     return null;
   }
   ```

4. Keep the "Not connected" state (lines 64-82) as that's a different UX concern (user has enabled but not authenticated).

5. The requirement is CLEAN-01: No lens displays the "email integration is off" message.
  </action>
  <verify>
Run TypeScript check: `cd /Volumes/Backup/CELESTE/BACK_BUTTON_CLOUD_PMS/apps/web && npx tsc --noEmit`
Grep to confirm removal: `grep -c "Email integration is off" apps/web/src/components/email/RelatedEmailsPanel.tsx` should return 0
  </verify>
  <done>RelatedEmailsPanel.tsx no longer displays "email integration is off" message; returns null when feature disabled.</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes without errors
2. grep for "email integration is off" returns 0 matches
3. grep for "reassign_work_order" and "archive_work_order" returns matches in WorkOrderCard.tsx
</verification>

<success_criteria>
- WO-03: WorkOrderCard has reassign and archive action buttons visible in UI
- CLEAN-01: "Email integration is off" message is removed from RelatedEmailsPanel
- Both components compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-gap-remediation-fix-all-failing-requirements-from-verification/13-01-SUMMARY.md`
</output>
