# Render.com deployment configuration for Micro-Action Extraction Service
# This file enables one-click deployment from GitHub to Render
#
# To deploy:
# 1. Push this file to your GitHub repository
# 2. Go to https://render.com/dashboard
# 3. Click "New" â†’ "Blueprint"
# 4. Connect your GitHub repository
# 5. Render will auto-detect this file and deploy
#
# Service will be available at: https://YOUR-SERVICE-NAME.onrender.com

services:
  - type: web
    name: celeste-microactions
    runtime: python
    plan: starter  # $7/month - 512MB RAM, 0.5 CPU
    region: oregon  # Change to your preferred region (oregon, frankfurt, singapore)

    # Build configuration
    buildCommand: pip install -r api/requirements.txt

    # Start command - runs the FastAPI service
    startCommand: cd api && uvicorn microaction_service:app --host 0.0.0.0 --port $PORT

    # Health check endpoint (Render will ping this)
    healthCheckPath: /health

    # Auto-deploy on git push
    autoDeploy: true

    # Environment variables
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.8"

      - key: ENVIRONMENT
        value: production

      - key: LOG_LEVEL
        value: info

      # Optional: Set custom confidence thresholds
      - key: AI_FALLBACK_THRESHOLD
        value: "0.75"

      - key: MIN_OUTPUT_CONFIDENCE
        value: "0.70"

      # Security secrets (set manually in Render Dashboard, NOT in git)
      - key: CELESTE_API_KEY
        sync: false

      - key: SUPABASE_JWT_SECRET
        sync: false

      - key: YACHT_SALT
        sync: false
